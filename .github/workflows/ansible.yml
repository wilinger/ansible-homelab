# This is a basic workflow to help you get started with Actions

name: Run Ansible Playbook

# Controls when the workflow will run
on:
  # Triggers the workflow on push or pull request events but only for the main branch
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  ansible:
    name: 'Ansible'
    runs-on: self-hosted

    defaults:
      run:
        shell: bash

    steps:
    - name: Checkout
      uses: actions/checkout@v2
    
    # - name: Run script file
    #   run: |
    #      chmod +x ./entrypoint.sh
    #      ./entrypoint.sh
    #   shell: bash

    - name: Setup Ansible
      uses: dawidd6/action-ansible-playbook@v2.5.0
      with:
        # Required, playbook filepath
        playbook: raspberrypi.yml
        # Optional, directory where playbooks live
        directory: ./
        # Optional, SSH private key
        key: ${{secrets.SSH_PRIVATE_KEY}}
        # Optional, literal inventory file contents
        # inventory: |
        #   [all]
        #   example.com

        #   [group1]
        #   example.com
        # Optional, SSH known hosts file content
        # known_hosts: .known_hosts
        # Optional, encrypted vault password
        vault_password: ${{secrets.VAULT_PASSWORD}}
        # Optional, galaxy requirements filepath
        requirements: ./requirements.yml
        # Optional, additional flags to pass to ansible-playbook
        # options: |
        #   --inventory .hosts
        #   --limit group1
        #   --extra-vars hello=there
        #   --verbose