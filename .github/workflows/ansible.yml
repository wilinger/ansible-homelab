# This is a basic workflow to help you get started with Actions

name: Run Ansible Playbook

# Controls when the workflow will run
on:
  # Triggers the workflow on push or pull request events but only for the main branch
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  ansible:
    name: 'Ansible'
    runs-on: self-hosted

    defaults:
      run:
        shell: bash

    steps:
    - name: Checkout
      uses: actions/checkout@v2

    - name: Play Ansible Playbook
      uses: arillso/action.playbook@master
      with:
        playbook: raspberrypi.yml
        inventory: inventory/hosts.yml
        galaxy_file: requirements.yml
        vault_password: ${{secrets.VAULT_PASSWORD}}
        private_key: ${{secrets.SSH_PRIVATE_KEY}}
        verbose: 0
      env:
        ANSIBLE_HOST_KEY_CHECKING: 'false'
        ANSIBLE_DEPRECATION_WARNINGS: 'false'
        
